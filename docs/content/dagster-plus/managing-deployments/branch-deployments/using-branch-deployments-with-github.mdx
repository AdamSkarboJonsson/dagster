---
title: Using Branch Deployments (CI) with GitHub Actions | Dagster+
description: Develop and test in the cloud.
---

# Using Branch Deployments (CI) with GitHub Actions

<Note>
  <strong>Before you get started:</strong> If you're using{" "}
  <a href="/dagster-plus/deployment/serverless">Serverless deployment</a> and
  you used the Dagster+ GitHub app to import your project, Branch Deployments
  are already set up for you!{" "}
</Note>

In this guide, we'll walk you through setting up Continuous Integration (CI) using [Branch Deployments](/dagster-plus/managing-deployments/branch-deployments) with GitHub Actions. Using this approach to branch deployments may be a good fit if:

- You use GitHub for version control
- You want Dagster to fully automate Branch Deployments

If you don't use GitHub for version control or want full control over your setup, check out the [Branch Deployments with the `dagster-cloud CLI` guide](/dagster-plus/managing-deployments/branch-deployments/using-branch-deployments).

---

## Prerequisites

To complete the steps in this guide, you'll need:

- **Organization Admin** permissions in Dagster+
- **The ability to run a new agent in your infrastructure**. This isn't required if you're using [Serverless deployment](/dagster-plus/deployment/serverless).
- **The ability to configure GitHub Actions for your repository**. This isn't required if you used the Dagster+ GitHub app to connect your repository as a [code location](/dagster-plus/managing-deployments/code-locations).

---

## Step 1: Generate a Dagster+ agent token

<Note>
  <strong>If using Serverless deployment</strong>, skip this step.
</Note>

<GenerateAgentToken />

---

## Step 2: Create and configure an agent

<Note>
  <strong>If using Serverless deployment</strong>, skip this step.
</Note>

<BDCreateConfigureAgent />

---

## Step 3: Set up the GitHub Action files

<Note>
  <strong>If you used the Dagster+ GitHub app to import your project</strong>,
  this step was already done for you.{" "}
  <a href="#step-4-configure-the-github-repository">Skip to the next step</a>.
</Note>

In this step, you'll add the required GitHub Action files to your GitHub repository. The files can be found in the [Hybrid quickstart repository](https://github.com/dagster-io/dagster-cloud-hybrid-quickstart) or [Serverless quickstart repository](https://github.com/dagster-io/dagster-cloud-serverless-quickstart), depending on the deployment type you're using.

<TabGroup>
<TabItem name="Hybrid">

### Hybrid

1. Add the following files to the repository:

   - [`dagster_cloud.yaml`](https://github.com/dagster-io/dagster-cloud-hybrid-quickstart/blob/main/dagster_cloud.yaml)
   - [`.github/workflows/dagster-cloud-deploy.yml`](https://github.com/dagster-io/dagster-cloud-hybrid-quickstart/blob/main/.github/workflows/dagster-cloud-deploy.yml)

2. In the [`dagster_cloud.yaml` file](/dagster-plus/managing-deployments/dagster-cloud-yaml), replace `build.registry` with the registry used by the [agent you created in Step 2](#step-2-create-and-configure-an-agent). For example:

   ```yaml
   # dagster_cloud.yaml

   locations:
     - location_name: example_location
       code_source:
         python_file: repo.py
       build:
         directory: ./example_location
         registry: 764506304434.dkr.ecr.us-east-1.amazonaws.com/branch-deployment-agent
   ```

3. In the `dagster-cloud-deploy.yml` file, uncomment the `step` associated with your registry type. This step is required to set up Docker registry access.

   For example, for an Amazon ECR registry, you'd uncomment the following portion of the file:

   ```yaml
   jobs:
     dagster-cloud-deploy:
       steps:
         - name: Configure AWS credentials
           uses: aws-actions/configure-aws-credentials@v1
           with:
             aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
             aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
             aws-region: ${{ secrets.AWS_REGION }}
   ```

4. Save and commit the files to the repository.

</TabItem>
<TabItem name="Serverless">

### Serverless

Add the following files to your project in a `.github/workflows` directory:

- [`branch_deployments.yml`](https://github.com/dagster-io/dagster-cloud-serverless-quickstart/blob/main/.github/workflows/branch_deployments.yml)
- [`deploy.yml`](https://github.com/dagster-io/dagster-cloud-serverless-quickstart/blob/main/.github/workflows/deploy.yml)

</TabItem>
</TabGroup>

---

## Step 4: Configure the GitHub repository

In this section, you'll:

1. [Configure GitHub Action secrets](#step-41-configure-github-action-secrets)
2. [Verify Action runs](#step-42-verify-action-runs)

### Step 4.1: Configure GitHub Action secrets

<Note>
  <strong>If you used the Dagster+ GitHub app to import your project</strong>,
  this step was already done for you.{" "}
  <a href="#step-5-access-the-branch-deployment">Skip to the next step</a>.
</Note>

In this step, you'll add the required secrets to the GitHub repository. **Note**: This isn't how environment variables and secrets can be used in Dagster code. Refer to the [Environment variables and secrets guide](/dagster-plus/managing-deployments/environment-variables-and-secrets) for more information.

<AddGitubRepositorySecret />

**For Hybrid deployments,** repeat steps 3-6 for each of the secrets required for your registry type:

<TabGroup>
  <TabItem name="Select registry type">
Select the tab for your registry type to view instructions.
  </TabItem>
  <TabItem name="Amazon ECR">

- `DAGSTER_CLOUD_API_TOKEN` - The Dagster+ agent token you created in [Step 1](#step-1-generate-a-dagster-agent-token)
- `ORGANIZATION_ID` - Your Dagster+ organization ID
- `AWS_ACCESS_KEY` - The **Access key ID** of the AWS IAM user you created in [Step 2](#step-2-create-and-configure-an-agent)
- `AWS_SECRET_ACCESS_KEY` - The **Secret access key** of the AWS IAM user you created in [Step 2](#step-2-create-and-configure-an-agent)
- `AWS_REGION` - The AWS region where your ECR registry is located

The **Actions secrets** page should look like the following:

<Image
alt="Configured GitHub Actions secrets for an AWS ECR registry"
src="/images/dagster-cloud/developing-testing/branch-deployments/github-aws-ecr.png"
width={1091}
height={623}
/>

</TabItem>
<TabItem name="Docker">

- `DAGSTER_CLOUD_API_TOKEN` - The Dagster+ agent token you created in [Step 1](#step-1-generate-a-dagster-agent-token)
- `ORGANIZATION_ID` - Your Dagster+ organization ID
- `DOCKERHUB_USERNAME` - Your DockerHub username
- `DOCKERHUB_TOKEN` - A DockerHub [access token](https://docs.docker.com/docker-hub/access-tokens/#create-an-access-token)

The **Actions secrets** page should look like the following:

<Image
alt="Required GitHub Actions secrets for a DockerHub registry"
src="/images/dagster-cloud/developing-testing/branch-deployments/github-dockerhub.png"
width={790}
height={318}
/>

</TabItem>
</TabGroup>

### Step 4.2: Verify Action runs

The last step is to verify that the Action runs successfully.

1. In the repository, click the **Actions** tab.
2. In the list of workflows, locate the latest branch deployment run. For example:

   <Image
   alt="A successful run for a Branch Deployment Action"
   src="/images/dagster-cloud/developing-testing/branch-deployments/github-verify-run.png"
   width={1263}
   height={651}
   />

If the run finished successfully, that's it!

---

## Step 5: Access the branch deployment

Now that Branch Deployments are configured, you can check out the preview in Dagster+. There are two ways to do this:

- [From a pull request](#from-a-pull-request)
- [Directly in Dagster+](#directly-in-dagster)

### From a pull request

Every pull request in the repository contains a **View in Cloud** link:

<Image
alt="View in Cloud preview link highlighted in a GitHub pull request"
src="/images/dagster-cloud/developing-testing/branch-deployments/github-cloud-preview-link.png"
width={922}
height={521}
/>

Clicking the link will open a branch deployment - or a preview of the changes - in Dagster+.

### Directly in Dagster+

You can also access branch deployments directly in Dagster+ from the **deployment switcher**:

<Image
alt="Highlighted branch deployment in the Dagster+ deployment switcher"
src="/images/dagster-cloud/developing-testing/branch-deployments/dagster-ui-deployment-switcher.png"
width={563}
height={311}
/>
