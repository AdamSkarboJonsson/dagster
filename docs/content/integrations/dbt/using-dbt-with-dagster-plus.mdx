---
title: "Using dbt with Dagster+ | Dagster Docs"
description: Deploy your dbt & Dagster project in Dagster+.
---

# Using dbt with Dagster+

Importing an existing dbt project in Dagster+ allows you to automatically load your dbt models as Dagster assets. This can be be done with:

- An existing dbt project that is not already using Dagster, or
- A Dagster project in which your dbt project is included

In this guide, we'll demonstrate by using an existing dbt project that doesn't use Dagster.

---

## Prerequisites

To follow the steps in this guide, you'll need **Dagster+ Organization Admin**, **Admin**, or **Editor** permissions. This is required to create a code location.

You'll also need **an existing dbt project** that contains the following files in the repository root:

- [`dbt_project.yml`](https://docs.getdbt.com/reference/dbt_project.yml)
- [`profiles.yml`](https://docs.getdbt.com/docs/core/connect-data-platform/profiles.yml)

---

## Step 1: Import your project in Dagster+

<Note>
  <strong>Heads up!</strong> This guide focuses on Serverless deployments in
  Dagster+, but dbt projects may also be deployed if using a Hybrid deployment.
  For more information about Hybrid deployments, refer to the{" "}
  <a href="/dagster-plus/deployment/hybrid#hybrid-deployments-in-dagster">
    Hybrid deployment documentation
  </a>
  .
</Note>

In this section, we'll demonstrate how to import an existing project Dagster+. Our example imports the project from a GitHub repository, but Dagster+ also supports Gitlab.

1. Sign in to your Dagster+ account.

2. Navigate to **Deployment > Code locations**.

3. Click **Add code location**.

4. Click **Import a dbt project**, then **Continue**.

5. At this point, you'll be prompted to select either GitHub or Gitlab. For this guide, we'll select **GitHub**.

6. You'll be redirected to GitHub, where you'll be prompted to authorize the Dagster+ application. **Note**: The profile or organization you're using to authorize Dagster+ must have read and write access to the repository containing the project.

   After the authorization is complete, you'll be redirected back to Dagster+.

7. In Dagster+, locate and select the repository containing the project by using the dropdowns. **Note**: dbt projects must have `dbt_profiles.yml` and `profiles.yml` files in the repository root or an error will display.

8. Click **Continue**. Dagster+ will begin importing the project and open a pull request to update the repository. This pull request adds a few files, which we'll discuss in the next section.

---

## Step 2: Review the repository changes

The file structure of the repository will change the first time a project is deployed using Dagster+. For dbt projects, a few things will happen:

- **A [`dagster_cloud.yaml` file](/dagster-plus/managing-deployments/dagster-cloud-yaml) will be created.** This file defines the project as a Dagster+ code location.
- **GitHub Action files will be created in `.github/workflows`.** These files, named `branch_deployments.yml` and `deploy.yml`, manage the deployments of the repository.
- **For dbt-only projects being deployed for the first time**, Dagster+ will create a new Dagster project in the repository using the [`dagster-dbt scaffold`](/integrations/dbt/reference#scaffolding-a-dagster-project-from-a-dbt-project) command. This will result in a Dagster project that matches the dbt project. For example, a dbt project named `my_dbt_project` will contain a Dagster project in `my_dbt_project/my_dbt_project` after the process completes. Refer to the [Dagster project files reference](/guides/understanding-dagster-project-files) to learn more about the files in a Dagster project.

**Use the following tabs** to see how the repository will change for a [dbt-only project](#dbt-only-projects) and a [dbt and Dagster project](#dbt-and-dagster-projects) being deployed for the first time.

<TabGroup>
<TabItem name="dbt-only projects">

### dbt-only projects

<Note>
  <strong>Looking for dbt and Dagster projects?</strong>{" "}
  <a href="#dbt-and-dagster-projects">Click here!</a>
</Note>

Before the Dagster+ changes, a typical dbt project would include files like `dbt_project.yml`, `profiles.yml`, dbt models in `.sql` format, and sbt seeds in `.csv` format. As this is a git repository, other files like `.gitignore`, `LICENSE` and `README.md` may also be included:

```shell
## dbt-only project
## before Dagster+ deployment

my_dbt_project
├── models
│   ├── my_model.sql
├── seeds
│   ├── my_seeds.csv
├── .gitignore
├── LICENSE
├── README.md
├── dbt_project.yml
└── profiles.yml
```

When the Dagster+ deployment process completes, the repository will now look like the following:

```shell
## dbt-only project
## after Dagster+ deployment

my_dbt_project
├── .github                                                ## GitHub Action files
│   ├── workflows
│   │   ├── branch_deployments.yml
│   │   ├── deploy.yml
├── models
│   ├── my_model.sql
├── my_dbt_project                                         ## New Dagster project
│   ├── my_dbt_project
│   │   ├── __init__.py
│   │   ├── assets.py
│   │   ├── definitions.py
│   │   ├── project.py
│   │   ├── schedules.py
│   ├── pyproject.toml
│   ├── setup.py
├── seeds
│   ├── my_seeds.csv
├── .gitignore
├── LICENSE
├── README.md
├── dagster_cloud.yaml                                     ## Dagster+ code location file
├── dbt_project.yml
└── profiles.yml
```

</TabItem>
<TabItem name="dbt and Dagster projects">

### dbt and Dagster projects

<Note>
  <strong>Looking for dbt-only projects?</strong>{" "}
  <a href="#dbt-only-projects">Click here!</a>
</Note>

After the Dagster+ changes, a dbt and Dagster project will include the files required for dbt and Dagster, some files related to git, and the newly-added Dagster+ files:

#### Update the cloud action files

When importing a project in Dagster+ using the "Import a Dagster Project" feature, various files are added to the repository containing the project, including the cloud action files. These files are optimized for general use in Dagster projects, but require some attention when the Dagster project includes a dbt component. Once these files are updated, the dbt & Dagster project will be successfully deployed to Dagster+.

Follow these steps to update the cloud action files. Note that in this example, the dbt project directory in the repository is called `dbt` and the [adapter used by dbt](https://docs.getdbt.com/docs/connect-adapters) is DuckDB. Depending on your dbt & Dagster project, you might need to update the code.

1. In your Dagster project, locate the `.github/workflows` directory.

2. Open the `deploy.yml` file.

3. Locate the Checkout for Python Executable Deploy step, which should be on or near line 38.

4. Add

```
- name: Parse dbt project and package with Dagster project
  if: steps.prerun.outputs.result == 'pex-deploy'
  run: |
    pip install pip --upgrade
    pip install dbt-duckdb
    cd project-repo/dbt
    dbt deps
    dbt parse
  shell: bash
```

5. Open the `branch_deployments.yml` file, then repeat steps 3 and 4.

#### Review the state of the repo

When deploying a Dagster project for the first time, the workflow adds various files - a [dagster_cloud.yaml file](/dagster-plus/managing-deployments/dagster-cloud-yaml), if it is missing, and two cloud action files under `.github/workflows`, `branch_deployments.yml` and `deploy.yml`, to manage the deployments of the repository.

After adding the files to the repository, a typical file structure would include the required files for dbt and Dagster, some files related to Git, like `.gitignore`, and the newly added files.

```shell
## dbt and Dagster project
## after Dagster+ deployment

my_dbt_and_dagster_project
├── .github                                                ## GitHub Action files
│   ├── workflows
│   │   ├── branch_deployments.yml
│   │   ├── deploy.yml
├── dbt
│   ├── models
│   │   ├── my_model.sql
│   ├── seeds
│   │   ├── my_seeds.csv
│   ├── dbt_project.yml
│   ├── profiles.yml
├── my_dbt_and_dagster_project
│   ├── __init__.py
│   ├── assets.py
│   ├── definitions.py
│   ├── project.py
│   ├── schedules.py
├── .gitignore
├── LICENSE
├── README.md
├── dagster_cloud.yaml                                     ## Dagster+ code location file
├── pyproject.toml
└── setup.py
```

</TabItem>
</TabGroup>

---

## What's next?

For an end-to-end example, from the project creation to the deployment to Dagster+, checkout out the Dagster & dbt course in [Dagster University](https://courses.dagster.io).

---

## Related

<ArticleList>
  <ArticleListItem
    title="dbt & Dagster"
    href="/integrations/dbt"
  ></ArticleListItem>
  <ArticleListItem
    title="dagster-dbt reference"
    href="/integrations/dbt/reference"
  ></ArticleListItem>
  <ArticleListItem
    title="Getting started with Dagster+"
    href="/dagster-plus"
  ></ArticleListItem>
  <ArticleListItem
    title="Dagster+ user roles and permissions"
    href="/dagster-plus/account/managing-users/managing-user-roles-permissions"
  ></ArticleListItem>
  <ArticleListItem
    title="dagster_cloud.yaml reference"
    href="/dagster-plus/managing-deployments/dagster-cloud-yaml"
  ></ArticleListItem>
  <ArticleListItem
    title="Dagster project files"
    href="/guides/understanding-dagster-project-files"
  ></ArticleListItem>
</ArticleList>

[//]: <> "TODO: Add examples of files"

When deploying a dbt & Dagster project through "Import a Dagster project", the cloud action added to the project repo will require some attention - using dbt requires some additional steps.deployment

[//]: <> "TODO: Add the steps as described in Dag Uni"

```
- name: Parse dbt project and package with Dagster project
  if: steps.prerun.outputs.result == 'pex-deploy'
  run: |
    pip install pip --upgrade
    pip install dbt-duckdb
    cd project-repo/analytics
    dbt deps
    dbt parse
  shell: bash
```

[//]: <> "TODO: Add the steps for GitLab as well"

## Understanding the cloud action files

The cloud action files added to your repository when importing a project are essential - they manage the deployments in Dagster+. While the files added through the "Import a dbt project" workflow are ready to use as-is, those added through the "Import a Dagster project" workflow requires some attention when importing a dbt & Dagster project. Let's take a closer look at the differences between the files and the required steps for when using dbt in a Dagster project.

For this exercise, let's consider the `deploy.yml` file added when importing a project from a GitHub repository. This guide will focus on the steps using the fast deployment with Python EXecutable (PEX). For more details about this approach, visit our [serverless deployment guide](/dagster-plus/deployment/serverless#customizing-the-runtime-environment).

The content of the `deploy.yml` file varies according to the import workflow that was selected - the [one added via "Import a dbt project"](https://github.com/dagster-io/dagster-cloud-action/blob/v0.1.40/github/serverless/dbt/deploy.yml) contains steps that are specific to dbt, while [the one added via "Import a Dagster project"](https://github.com/dagster-io/dagster-cloud-action/blob/v0.1.40/github/serverless/deploy.yml) is missing the required steps for dbt since it is the basic template for all Dagster projects. This being said, the latter can easily be updated to work with a project using dbt.

### Shared steps

The `deploy.yml` file includes steps that are required to deploy a project in Dagster+, whether the project is using dbt or not. These steps include running checks before the run, checking out the directory where the content of the project repository is, and deploying the project using PEX.

The first two steps are straightforward and self-explanatory. After the prerun checks are completed, the project repository is checked out before any other actions are taken.

```
- name: Prerun Checks
  id: prerun
  uses: dagster-io/dagster-cloud-action/actions/utils/prerun@v0.1

- name: Checkout
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: actions/checkout@v3
  with:
    ref: ${{ github.head_ref }}
    path: project-repo
```

Once these steps are done, the following step will build and deploy the content of the project, according to the provided configurations.

```
- name: Python Executable Deploy
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/build_deploy_python_executable@v0.1
  with:
    dagster_cloud_file: "$GITHUB_WORKSPACE/project-repo/$DAGSTER_CLOUD_FILE"
    build_output_dir: "$GITHUB_WORKSPACE/build"
    python_version: "${{ env.PYTHON_VERSION }}"
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Steps specific to dbt

<Note>
  <strong>Note</strong>: This guide uses the command <code>dagster-dbt project prepare-for-deployment</code>,
  which uses the experimental class <code>DbtProject</code>. Visit the{" "}
  <a href="/\_apidocs/libraries/dagster-dbt#dagster_dbt.DbtProject">
    dagster-dbt library API reference
  </a>{" "}
  for more info.
</Note>

When it comes to Dagster projects using dbt, more steps are required to deploying successfully to Dagster+.

The first two steps are more straightforward then the third one - one validates the configuration and the other initializes the CI.

```
- name: Validate configuration
  id: ci-validate
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/utils/dagster-cloud-cli@v0.1
  with:
    command: "ci check --project-dir project-repo --dagster-cloud-yaml-path ${{ env.DAGSTER_CLOUD_FILE }}"

- name: Initialize build session
  id: ci-init
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/utils/ci-init@v0.1
  with:
    project_dir: project-repo
    dagster_cloud_yaml_path: ${{ env.DAGSTER_CLOUD_FILE }}
    deployment: 'prod'
```

Once theses steps are completed, it is time to prepare the dbt project for deployment. This step uses the `dagster-dbt project prepare-for-deployment` command, which will find the `DbtProject` objects in your project and run each `manifest_preparer`. This ensures that `manifest.json` exists and can be found at the expected path when the dbt assets are created. For more information about `DbtProject` and its manifest_preparer`, visit the [dagster-dbt library API reference](/\_apidocs/libraries/dagster-dbt#dagster_dbt.DbtProject).

```
- name: Prepare DBT project for deployment
  if: steps.prerun.outputs.result == 'pex-deploy'
  # --upgrade-strategy eager picks up newer packages that are required for things to work
  run: |
    pip install pip --upgrade
    cd project-repo/${{ env.DAGSTER_PROJECT_NAME }}
    pip install . --upgrade --upgrade-strategy eager
    dagster-dbt project prepare-for-deployment --file ${{ env.DAGSTER_PROJECT_NAME }}/project.py
    # The cli command below can be used to manage syncing the prod manifest to branches if state_path is set on the DbtProject
    # dagster-cloud ci dagster-dbt project manage-state --file ${{ env.DAGSTER_PROJECT_NAME }}/project.py
  shell: bash
```


## What's next

For an end-to-end example, from the project creation to the deployment to Dagster+, checkout out the Dagster & dbt course in [Dagster University](https://courses.dagster.io).